### Improved HTTP/2 throughput

With the emerging popularity of HTTP/2 and gRPC, our customers discovered a serious gap in `SocketsHttpHandler`'s HTTP/2 download speed when connected to geographically distant servers with significant network delay. On links with a high [bandwidth-delay product](https://en.wikipedia.org/wiki/Bandwidth-delay_product), some users reported 5x-10x differences compared to other implementations which were able to utilize the link's physical bandwidth. To give an example: in one of our benchmarks curl was able to reach the maximum 10 Mbit/s rate of specific cross-atlantic link, while `SocketsHttpHanlder` speed topped at 2.5 Mbit/s. Amongst other things, this was heavily impacting gRPC streaming scenarios.

The root cause of the issue turned out to be the fixed-size HTTP/2 receive window, with it's 64KB size being too small to keep the network busy when `WINDOW_UPDATE` frames are received with a high delay, meaning that HTTP/2's own flow control mechanism was stalling the network link.

We considered "cheap" options to solve this, such as defining a large fixed-size window - which could result in unnecessarily high memory footprint -, or to ask the user to manually configure the receive window based on empirical observations. None of these seemed to be satisfactory, so we decided to implement an automatic window scaling algorithm similar to the one in TCP or QUIC ([dotnet/runtime#54755](https://github.com/dotnet/runtime/pull/54755)).

This turned out to work well, lifting download speeds close to their theoretical maximum. However, since HTTP/2 PING frames are used to determine the round-trip time of the HTTP/2 connection, we had to be very careful to avoid triggering the server's [PING flood](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9512) protection mechanisms. We implemented an algorithm that should work well with [gRPC](https://github.com/grpc/proposal/blob/master/A8-client-side-keepalive.md#server-enforcement) and existing HTTP servers, but we wanted to make sure we have an escape patch in case something goes wrong. Dynamic window sizing - and consequentially PING frames - can be turned off by setting the `System.Net.SocketsHttpHandler.Http2FlowControl.DisableDynamicWindowSizing` `AppContext` switch to `true`. If this ever becomes necessary, there's still a way to fix throughput issues by assigning a higher value to [`SocketsHttpHandler.InitialHttp2StreamWindowSize`](https://docs.microsoft.com/en-us/dotnet/api/system.net.http.socketshttphandler.initialhttp2streamwindowsize).
